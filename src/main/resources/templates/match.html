<!doctype html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: head"></head>

<body>

	<div th:replace="fragments/header :: header"></div>
	
	<div>
	
		<h1>Match Details</h1>
		
		<div class="table-responsive">
			<table class="branded-table">
				<thead>
					<tr>
						<th>DATE</th>
						<th>EQUIPE A</th>
						<th></th>
						<th></th>
						<th>EQUIPE B</th>
						<th>HOMME DU MATCH</th>
					</tr>
				</thead>
	
				<tbody>
					<tr>
						<td th:utext="${match.date}">0</td>			
						<td th:utext="${match.equipeA.equipe.name} + ' ('+ ${match.equipeA.capitaine.name} +')'">0</td>
						<td th:utext="${match.equipeA.marques}">0</td>
						<td th:utext="${match.equipeB.marques}">0</td>
						<td th:utext="${match.equipeB.equipe.name} + ' ('+ ${match.equipeB.capitaine.name} +')'">0</td>
						<td th:utext="${match.motm.name}">0</td>
					</tr>
				</tbody>
			</table>
		</div>

	</div>
	
	<div>
	
		<h1>BUTS</h1>
		
		<div class="table-responsive">
			<table class="branded-table">
				<thead>
					<tr>
						<th>Minute</th>
						<th>Buteur</th>
						<th>Passeur</th>
						<th>Score</th>
					</tr>
				</thead>
		
				<tbody>
					<tr th:each="but,iter : ${buts}">
						<td th:text="${but.minute} + ''">Minute</td>
						<td th:utext="${but.buteur.name}">Buteur</td>
						<td th:utext="${but.passeur.name}">Passeur</td>
						<td th:utext="${but.score}">Score</td>
					</tr>
				</tbody>
			</table>
		</div>

	</div>
	
	<div class="joueurs-row">
		
		<div class="joueurs" id="joueurs-domicile">
		
			<h1 th:utext="${match.equipeA.equipe.name}"></h1>

			<div class="table-responsive">
				<table class="branded-table sortable">
					<thead>
						<tr>
							<th data-sort="string">NOM</th>
							<th data-sort="number">BUTS</th>
							<th data-sort="number">PASSES</th>
							<th>MOTM</th>
						</tr>
					</thead>
		
					<tbody>
						<tr th:each="joueurDomicile,iter : ${joueursDomicile}">
							<td th:utext="${joueurDomicile.name}">0</td>
							<td th:utext="${joueurDomicile.butsM}">0</td>
							<td th:utext="${joueurDomicile.passesD}">0</td>
							<td>
								<button th:onclick="openVoteModal([[${joueurDomicile.id}]])">Voter</button>
							</td>
						</tr>
					</tbody>
				</table>
			</div>
			
		</div>
		
		<div class="joueurs" id="joueurs-exterieur">
		
			<h1 th:utext="${match.equipeB.equipe.name}"></h1>

			<div class="table-responsive">
				<table class="branded-table sortable">
					<thead>
						<tr>
							<th data-sort="string">NOM</th>
							<th data-sort="number">BUTS</th>
							<th data-sort="number">PASSES</th>
							<th>MOTM</th>
						</tr>
					</thead>
		
					<tbody>
						<tr th:each="joueurExterieur,iter : ${joueursExterieur}">
							<td th:utext="${joueurExterieur.name}">0</td>
							<td th:utext="${joueurExterieur.butsM}">0</td>
							<td th:utext="${joueurExterieur.passesD}">0</td>
							<td>
								<button th:onclick="openVoteModal([[${joueurExterieur.id}]])">Voter</button>
							</td>
						</tr>
					</tbody>
				</table>
			</div>
		
		</div>
	</div>
	
	<div>
	
		<h1>Match Highlight</h1>
		
		<div class="table-responsive">
			<table class="branded-table">
				<thead>
					<tr>
						<th>Highlight</th>
					</tr>
				</thead>
		
				<tbody>
					<tr th:each="highlight,iter : ${highlights}">
						<td th:utext="${highlight.description}">Highlight</td>
					</tr>
				</tbody>
			</table>
		</div>

	</div>
	
	<div>
	
		<h1>VOTES HOMME DU MATCH</h1>

		<div class="table-responsive">
			<table class="branded-table">
				<thead>
					<tr>
						<th>JOEUR</th>
						<th>VOTES</th>
					</tr>
				</thead>
	
				<tbody>
					<tr th:each="motmVotes,iter : ${motmVotesList}">
						<td th:utext="${motmVotes.joueur.name}">0</td>
						<td th:utext="${motmVotes.count}">0</td>
					</tr>
				</tbody>
			</table>
		</div>

	</div>
	
	
	
	
	
	
	
	
	
	
	
	
	
	<!-- Vote Modal -->
	<input type="hidden" id="matchId" th:value="${match.id}" />
	<div id="voteModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index:9999;">
		<div style="background:white; padding:20px; border-radius:10px; width:90%; max-width:400px;">
			<h2>Voter pour ce joueur</h2>
			<form id="voteForm" onsubmit="submitVote(event)">
				<input type="hidden" id="playerId" name="playerId">
				<label for="username">Votre nom (Tel qu’affichée dans le système):</label><br>
				<input type="text" id="username" name="username" required><br><br>
				<button type="submit">Voter</button>
				<button type="button" onclick="closeVoteModal()">Annuler</button>
			</form>
		</div>
	</div>
	
</body>



<script>
	function openVoteModal(playerId) {
		document.getElementById('playerId').value = playerId;
		document.getElementById('voteModal').style.display = 'flex';
	}

	function closeVoteModal() {
		document.getElementById('voteModal').style.display = 'none';
	}

	function submitVote(event) {
		event.preventDefault();

		const playerId = document.getElementById('playerId').value;
		const username = document.getElementById('username').value;
		const matchId = document.getElementById('matchId').value;

		fetch('/motm/vote', {
			method: 'POST',
			headers: { 'Content-Type': 'application/json' },
			body: JSON.stringify({ vote : playerId, username : username, match : matchId })
		})
		.then(response => {
			if (response.ok) {
				alert('Vote submitted!');
				closeVoteModal();
			} else {
				alert('Error submitting vote.');
			}
		})
		.catch(() => alert('Server error.'));
	}
</script>

<script>
	document.addEventListener('DOMContentLoaded', function () {
	  document.querySelectorAll('.sortable').forEach(function (table) {
	    const headers = table.querySelectorAll('th');

	    headers.forEach(function (header, columnIndex) {
	      header.style.cursor = 'pointer';
	      header.addEventListener('click', function () {
	        const tbody = table.querySelector('tbody');
	        const rows = Array.from(tbody.querySelectorAll('tr')).filter(r => r.querySelectorAll('td').length > 0);
	        const type = header.dataset.sort || 'string';
	        const ascending = !header.classList.contains('sorted-asc');

	        // Clear sort indicators for this table only
	        headers.forEach(th => th.classList.remove('sorted-asc', 'sorted-desc'));
	        header.classList.add(ascending ? 'sorted-asc' : 'sorted-desc');

	        rows.sort((a, b) => {
	          const aText = a.cells[columnIndex]?.textContent.trim() || '';
	          const bText = b.cells[columnIndex]?.textContent.trim() || '';

	          if (type === 'number') {
	            return ascending ? (parseFloat(aText) - parseFloat(bText)) : (parseFloat(bText) - parseFloat(aText));
	          } else {
	            return ascending ? aText.localeCompare(bText) : bText.localeCompare(aText);
	          }
	        });

	        rows.forEach(row => tbody.appendChild(row));
	      });
	    });
	  });
	});
</script>